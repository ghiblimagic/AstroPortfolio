---
import type { MarkdownHeading } from 'astro';

interface Props {
  headings: MarkdownHeading[];
}

const { headings } = Astro.props;
const filteredHeadings = headings.filter(h => h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <nav class="toc mb-8 p-6 rounded-lg border border-gray-200 shadow-lg">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Table of Contents</h2>
      <button 
        id="toc-toggle" 
        class="text-blue-600 hover:text-blue-800 font-semibold transition-transform"
        aria-label="Toggle table of contents"
        aria-expanded="true"
      >
        <svg 
          id="toc-arrow" 
          class="w-5 h-5 transition-transform duration-200" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
    </div>
    <ul id="toc-list" class="space-y-2 transition-all duration-300 overflow-hidden">
      {filteredHeadings.map((heading) => (
        <li 
          class="toc-item"
          style={`margin-left: ${(heading.depth - 2) * 1}rem`}
        >
          <a 
            href={`#${heading.slug}`}
            class={`text-blue-600 hover:text-blue-800 hover:underline block transition-colors ${
              heading.depth === 2 ? 'font-semibold' : ''
            }`}
          >
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<script>
  const toggleButton = document.getElementById('toc-toggle');
  const tocList = document.getElementById('toc-list');
  const arrow = document.getElementById('toc-arrow');
  
  let isOpen = true;
  
  toggleButton?.addEventListener('click', () => {
    isOpen = !isOpen;
    
    if (tocList) {
      if (isOpen) {
        tocList.style.maxHeight = tocList.scrollHeight + 'px';
        tocList.style.opacity = '1';
      } else {
        tocList.style.maxHeight = '0';
        tocList.style.opacity = '0';
      }
    }
    
    if (arrow) {
      arrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(-180deg)';
    }
    
    toggleButton?.setAttribute('aria-expanded', isOpen.toString());
  });
  
  // Set initial max-height for smooth animation
  if (tocList && isOpen) {
    tocList.style.maxHeight = tocList.scrollHeight + 'px';
  }
</script>

<style>
  .toc {
    max-height: calc(100vh - 2rem);
    overflow-y: auto;
  }
  
  #toc-list {
    transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
  }
</style>